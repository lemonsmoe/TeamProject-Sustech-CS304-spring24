{"ast":null,"code":"import Layout from '@/components/Layout.vue';\nimport request from \"@/utils/request\";\nexport default {\n  components: {\n    Layout\n  },\n  data() {\n    return {\n      course: {\n        title: '马克思主义基本原理',\n        category: '计划',\n        type: '理论课',\n        method: '本科计划内课程',\n        unit: '马克思主义学院',\n        credit: 2.5\n      },\n      avgRating: 0,\n      reviewCount: 0,\n      courseStats: [],\n      form: {\n        sort: '',\n        semester: '',\n        rating: ''\n      },\n      reviews: [],\n      newReview: {\n        course_id: this.$route.params.id,\n        rating: null,\n        difficulty: '',\n        homework: '',\n        grading: '',\n        harvest: '',\n        comment: ''\n      },\n      currentPage: 1,\n      pageSize: 10,\n      totalReviews: 0\n    };\n  },\n  mounted() {\n    this.fetchCourseInfo();\n    this.fetchCourseStats();\n    this.fetchCourseReviews();\n  },\n  methods: {\n    handleCollapse() {\n      console.log('Toggle sidebar');\n    },\n    handleFullScreen() {\n      console.log('Toggle full screen');\n    },\n    goBack() {\n      this.$router.go(-1); // 返回前一个页面\n    },\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.fetchCourseReviews(); // Fetch new page data\n    },\n    fetchCourseInfo() {\n      request.get(`/evaluation/course/${this.$route.params.id}`).then(res => {\n        if (res.status === 200) {\n          this.course = res.data;\n          this.fetchCourseReviewBrief(); // 获取课程的平均评分和评价人数\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error(\"获取课程信息失败:\", error);\n      });\n    },\n    fetchCourseReviewBrief() {\n      request.get(`/evaluation/review/getbrief`).then(res => {\n        if (res.status === 200) {\n          const review = res.data.find(r => r.course_id === this.$route.params.id);\n          if (review) {\n            this.avgRating = review.avg_rating;\n            this.reviewCount = review.review_count;\n          }\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error(\"获取课程评价信息失败:\", error);\n      });\n    },\n    fetchCourseReviews() {\n      request.get(`/evaluation/review/getall/${this.$route.params.id}`).then(res => {\n        if (res.status === 200) {\n          console.log(res.data);\n          this.reviews = res.data;\n          this.totalReviews = res.data.length;\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error(\"获取课程评价失败:\", error);\n      });\n    },\n    fetchCourseStats() {\n      request.get(`/evaluation/review/stats/${this.$route.params.id}`).then(res => {\n        if (res.status === 200) {\n          this.courseStats = res.data;\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error(\"获取课程评价统计失败:\", error);\n      });\n    },\n    submitReview() {\n      if (!this.newReview.rating || !this.newReview.difficulty || !this.newReview.homework || !this.newReview.grading || !this.newReview.harvest || !this.newReview.comment) {\n        this.$message.error('请填写完整信息');\n        return;\n      }\n      request.post('/evaluation/review/put', this.newReview).then(res => {\n        if (res.status === 200) {\n          this.$message.success('评价发布成功');\n          // 清空表单\n          this.newReview = {\n            course_id: this.$route.params.id,\n            rating: null,\n            difficulty: '',\n            homework: '',\n            grading: '',\n            harvest: '',\n            comment: ''\n          };\n          this.fetchCourseReviews(); // 刷新评价列表\n          this.fetchCourseStats(); // 刷新统计数据\n        } else {\n          this.$message.error(res.data.msg);\n        }\n      }).catch(error => {\n        console.error(\"发布评价失败:\", error);\n      });\n    }\n  }\n};","map":{"version":3,"names":["Layout","request","components","data","course","title","category","type","method","unit","credit","avgRating","reviewCount","courseStats","form","sort","semester","rating","reviews","newReview","course_id","$route","params","id","difficulty","homework","grading","harvest","comment","currentPage","pageSize","totalReviews","mounted","fetchCourseInfo","fetchCourseStats","fetchCourseReviews","methods","handleCollapse","console","log","handleFullScreen","goBack","$router","go","handleCurrentChange","page","get","then","res","status","fetchCourseReviewBrief","$message","error","msg","catch","review","find","r","avg_rating","review_count","length","submitReview","post","success"],"sources":["src/views/PingJiao/CourseDetail.vue"],"sourcesContent":["<template>\r\n  <Layout>\r\n    <el-main>\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <div class=\"back_button\">\r\n          <el-button type=\"text\" @click=\"goBack\">返回</el-button>\r\n        </div>\r\n      </div>\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        \r\n        <div>\r\n          <h2>{{ course.course_name }}</h2>\r\n          <p>授课类型：{{ course.course_type }}</p>\r\n          <p>开课单位：{{ course.college }}</p>\r\n          <p>学分：{{ course.credit }}</p>\r\n          <p>平均评分：{{ avgRating }}</p>\r\n          <p>评价人数：{{ reviewCount }}</p>\r\n        </div>\r\n      </el-card>\r\n\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span>课程评价统计</span>\r\n        </div>\r\n        <el-row gutter=\"20\">\r\n  <el-col :span=\"6\">\r\n    <div class=\"stat-item\">\r\n      <h3>难度</h3>\r\n      <div class=\"stat-details\">\r\n        简单: {{ courseStats.difficulty.简单 }}<span></span>\r\n        普通: {{ courseStats.difficulty.普通 }}<span></span>\r\n        较难: {{ courseStats.difficulty.较难 }}\r\n      </div>\r\n    </div>\r\n  </el-col>\r\n  <el-col :span=\"6\">\r\n    <div class=\"stat-item\">\r\n      <h3>作业</h3>\r\n      <div class=\"stat-details\">\r\n       少: {{ courseStats.homework.少 }}<span></span>\r\n       适中: {{ courseStats.homework.适中 }}<span></span>\r\n       多: {{ courseStats.homework.多 }}\r\n      </div>\r\n    </div>\r\n  </el-col>\r\n  <el-col :span=\"6\">\r\n    <div class=\"stat-item\">\r\n      <h3>给分</h3>\r\n      <div class=\"stat-details\">\r\n       低: {{ courseStats.grading.低 }}<span></span>\r\n       中: {{ courseStats.grading.中 }}<span></span>\r\n       高: {{ courseStats.grading.高 }}\r\n      </div>\r\n    </div>\r\n  </el-col>\r\n  <el-col :span=\"6\">\r\n    <div class=\"stat-item\">\r\n      <h3>收获</h3>\r\n      <div class=\"stat-details\">\r\n        少: {{ courseStats.harvest.少 }}<span></span>\r\n        中: {{ courseStats.harvest.中 }}<span></span>\r\n        多: {{ courseStats.harvest.多 }}\r\n      </div>\r\n    </div>\r\n  </el-col>\r\n</el-row>\r\n      </el-card>\r\n\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span>点评信息</span>\r\n        </div>\r\n        <div class=\"comments-section\">\r\n          <el-card v-for=\"review in reviews\" :key=\"review.id\" class=\"comment-card\">\r\n            <div class=\"comment-header\">\r\n              <span>{{ review.user_name }}</span>\r\n            </div>\r\n            <div class=\"comment-body\">\r\n              <p>评分: {{ review.rating }}</p>\r\n              <div class=\"review-attribute\">\r\n                难度: {{ review.difficulty }}\r\n                作业: {{ review.homework }}\r\n                给分: {{ review.grading }}\r\n                收获: {{ review.harvest }}\r\n              </div>\r\n              <p>{{ review.comment }}</p>\r\n            </div>\r\n          </el-card>\r\n          <el-pagination\r\n            style=\"margin-top: 20px;\"\r\n            @current-change=\"handleCurrentChange\"\r\n            :current-page=\"currentPage\"\r\n            :page-size=\"pageSize\"\r\n            layout=\"total, prev, pager, next\"\r\n            :total=\"totalReviews\">\r\n          </el-pagination>\r\n        </div>\r\n      </el-card>\r\n\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span>提交评价</span>\r\n        </div>\r\n        <div class=\"quick-reply-section\">\r\n          <el-form :model=\"newReview\" class=\"review-form\">\r\n            <el-form-item label=\"评分\">\r\n              <el-input v-model=\"newReview.rating\" type=\"number\" placeholder=\"请输入评分\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"难度\">\r\n              <el-select v-model=\"newReview.difficulty\" placeholder=\"请选择难度\">\r\n                <el-option label=\"简单\" value=\"简单\"></el-option>\r\n                <el-option label=\"普通\" value=\"普通\"></el-option>\r\n                <el-option label=\"较难\" value=\"较难\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"作业\">\r\n              <el-select v-model=\"newReview.homework\" placeholder=\"请选择作业量\">\r\n                <el-option label=\"少\" value=\"少\"></el-option>\r\n                <el-option label=\"适中\" value=\"适中\"></el-option>\r\n                <el-option label=\"多\" value=\"多\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"给分\">\r\n              <el-select v-model=\"newReview.grading\" placeholder=\"请选择给分\">\r\n                <el-option label=\"低\" value=\"低\"></el-option>\r\n                <el-option label=\"中\" value=\"中\"></el-option>\r\n                <el-option label=\"高\" value=\"高\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"收获\">\r\n              <el-select v-model=\"newReview.harvest\" placeholder=\"请选择收获\">\r\n                <el-option label=\"少\" value=\"少\"></el-option>\r\n                <el-option label=\"中\" value=\"中\"></el-option>\r\n                <el-option label=\"多\" value=\"多\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"评论\">\r\n              <el-input type=\"textarea\" v-model=\"newReview.comment\" placeholder=\"请输入评论\"></el-input>\r\n            </el-form-item>\r\n            <el-button type=\"primary\" @click=\"submitReview\">提交评价</el-button>\r\n          </el-form>\r\n        </div>\r\n      </el-card>\r\n    </el-main>\r\n  </Layout>\r\n</template>\r\n\r\n<script>\r\nimport Layout from '@/components/Layout.vue'\r\nimport request from \"@/utils/request\";\r\n\r\nexport default {\r\n  components: {\r\n      Layout\r\n  },\r\n  data() {\r\n    return {\r\n      course: {\r\n        title: '马克思主义基本原理',\r\n        category: '计划',\r\n        type: '理论课',\r\n        method: '本科计划内课程',\r\n        unit: '马克思主义学院',\r\n        credit: 2.5\r\n      },\r\n      avgRating: 0,\r\n      reviewCount: 0,\r\n      courseStats: [],\r\n      form: {\r\n        sort: '',\r\n        semester: '',\r\n        rating: ''\r\n      },\r\n      reviews: [],\r\n      newReview: {\r\n        course_id: this.$route.params.id,\r\n        rating: null,\r\n        difficulty: '',\r\n        homework: '',\r\n        grading: '',\r\n        harvest: '',\r\n        comment: ''\r\n      },\r\n      currentPage: 1,\r\n      pageSize: 10,\r\n      totalReviews: 0\r\n    };\r\n  },\r\n  mounted() {\r\n    this.fetchCourseInfo();\r\n    this.fetchCourseStats();\r\n    this.fetchCourseReviews();\r\n  },\r\n  methods: {\r\n    handleCollapse() {\r\n      console.log('Toggle sidebar');\r\n    },\r\n    handleFullScreen() {\r\n      console.log('Toggle full screen');\r\n    },\r\n    goBack() {\r\n      this.$router.go(-1);  // 返回前一个页面\r\n    },\r\n    handleCurrentChange(page) {\r\n      this.currentPage = page;\r\n      this.fetchCourseReviews(); // Fetch new page data\r\n    },\r\n    fetchCourseInfo() {\r\n      request.get(`/evaluation/course/${this.$route.params.id}`)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            this.course = res.data;\r\n            this.fetchCourseReviewBrief(); // 获取课程的平均评分和评价人数\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"获取课程信息失败:\", error);\r\n        });\r\n    },\r\n    fetchCourseReviewBrief() {\r\n      request.get(`/evaluation/review/getbrief`)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            const review = res.data.find(r => r.course_id === this.$route.params.id);\r\n            if (review) {\r\n              this.avgRating = review.avg_rating;\r\n              this.reviewCount = review.review_count;\r\n            }\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"获取课程评价信息失败:\", error);\r\n        });\r\n    },\r\n    fetchCourseReviews() {\r\n      request.get(`/evaluation/review/getall/${this.$route.params.id}`)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            console.log(res.data);\r\n            this.reviews = res.data;\r\n            this.totalReviews = res.data.length;\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"获取课程评价失败:\", error);\r\n        });\r\n    },\r\n    fetchCourseStats() {\r\n      request.get(`/evaluation/review/stats/${this.$route.params.id}`)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            this.courseStats = res.data;\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"获取课程评价统计失败:\", error);\r\n        });\r\n    },\r\n\r\n    submitReview() {\r\n      if (!this.newReview.rating  || !this.newReview.difficulty || !this.newReview.homework || !this.newReview.grading || !this.newReview.harvest || !this.newReview.comment) {\r\n        this.$message.error('请填写完整信息');\r\n        return;\r\n      }\r\n      request.post('/evaluation/review/put', this.newReview)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            this.$message.success('评价发布成功');\r\n            // 清空表单\r\n            this.newReview = {\r\n              course_id: this.$route.params.id,\r\n              rating: null,\r\n              difficulty: '',\r\n              homework: '',\r\n              grading: '',\r\n              harvest: '',\r\n              comment: ''\r\n            };\r\n            this.fetchCourseReviews(); // 刷新评价列表\r\n            this.fetchCourseStats(); // 刷新统计数据\r\n          } else {\r\n            this.$message.error(res.data.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"发布评价失败:\", error);\r\n        });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.back_button {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n.review-attribute {\r\n  margin-right: 20px; /* 控制属性之间的间距 */\r\n  flex: 1; /* 让每个属性平分容器宽度 */\r\n}\r\n.forum-container {\r\n  width: 80%;\r\n  margin: auto;\r\n}\r\n.comment-card {\r\n  margin-top: 20px;\r\n}\r\n.comment-header {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.user-avatar {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  margin-right: 10px;\r\n}\r\n.comment-body {\r\n  margin-top: 10px;\r\n}\r\n.comment-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  margin-top: 10px;\r\n}\r\n.quick-reply-section {\r\n  margin-top: 20px;\r\n}\r\n.stat-item {\r\n  margin-bottom: 20px;\r\n}\r\n.stat-details {\r\n  /* display: flex; */\r\n  justify-content: space-between;\r\n}\r\n</style>\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}