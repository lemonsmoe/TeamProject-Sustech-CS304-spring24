{"ast":null,"code":"import Layout from '@/components/Layout.vue';\nimport request from \"@/utils/request\";\nexport default {\n  components: {\n    Layout\n  },\n  data() {\n    return {\n      course: {\n        title: '马克思主义基本原理',\n        category: '计划',\n        type: '理论课',\n        method: '本科计划内课程',\n        unit: '马克思主义学院',\n        credit: 2.5\n      },\n      courseStats: [],\n      form: {\n        sort: '',\n        semester: '',\n        rating: ''\n      },\n      reviews: [],\n      newReview: {\n        course_id: this.$route.params.id,\n        rating: null,\n        ratingCount: null,\n        difficulty: '',\n        homework: '',\n        grading: '',\n        harvest: '',\n        comment: ''\n      },\n      currentPage: 1,\n      pageSize: 10,\n      totalReviews: 0\n    };\n  },\n  mounted() {\n    this.fetchCourseStats();\n    this.fetchCourseReviews();\n  },\n  methods: {\n    handleCollapse() {\n      console.log('Toggle sidebar');\n    },\n    handleFullScreen() {\n      console.log('Toggle full screen');\n    },\n    goBack() {\n      this.$router.go(-1); // 返回前一个页面\n    },\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.fetchCourseReviews(); // Fetch new page data\n    },\n    fetchCourseStats() {\n      request.get(`/evaluation/review/stats/${this.$route.params.id}`).then(res => {\n        if (res.status === 200) {\n          this.courseStats = res.data;\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error(\"获取课程评价统计失败:\", error);\n      });\n    },\n    fetchCourseReviews() {\n      request.get(`/evaluation/reviews/${this.$route.params.id}`).then(res => {\n        if (res.status === 200) {\n          this.reviews = res.data;\n          this.totalReviews = res.data.length;\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error(\"获取课程评价失败:\", error);\n      });\n    },\n    submitReview() {\n      if (!this.newReview.rating || !this.newReview.ratingCount || !this.newReview.difficulty || !this.newReview.homework || !this.newReview.grading || !this.newReview.harvest || !this.newReview.comment) {\n        this.$message.error('请填写完整信息');\n        return;\n      }\n      request.post('/evaluation/review/put', this.newReview).then(res => {\n        if (res.status === 200) {\n          this.$message.success('评价发布成功');\n          // 清空表单\n          this.newReview = {\n            course_id: this.$route.params.id,\n            rating: null,\n            ratingCount: null,\n            difficulty: '',\n            homework: '',\n            grading: '',\n            harvest: '',\n            comment: ''\n          };\n          this.fetchCourseReviews(); // 刷新评价列表\n          this.fetchCourseStats(); // 刷新统计数据\n        } else {\n          this.$message.error(res.data.msg);\n        }\n      }).catch(error => {\n        console.error(\"发布评价失败:\", error);\n      });\n    }\n  }\n};","map":{"version":3,"names":["Layout","request","components","data","course","title","category","type","method","unit","credit","courseStats","form","sort","semester","rating","reviews","newReview","course_id","$route","params","id","ratingCount","difficulty","homework","grading","harvest","comment","currentPage","pageSize","totalReviews","mounted","fetchCourseStats","fetchCourseReviews","methods","handleCollapse","console","log","handleFullScreen","goBack","$router","go","handleCurrentChange","page","get","then","res","status","$message","error","msg","catch","length","submitReview","post","success"],"sources":["src/views/PingJiao/CourseDetail.vue"],"sourcesContent":["<template>\r\n  <Layout>\r\n    <el-main>\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <div class=\"back_button\">\r\n            <el-button type=\"text\" @click=\"goBack\">返回</el-button>\r\n          </div>\r\n          <span>课程详细信息</span>\r\n        </div>\r\n        <div>\r\n          <h2>{{ course.title }}</h2>\r\n          <p>选课类别：{{ course.category }}</p>\r\n          <p>授课类型：{{ course.type }}</p>\r\n          <p>授课方式：{{ course.method }}</p>\r\n          <p>开课单位：{{ course.unit }}</p>\r\n          <p>学分：{{ course.credit }}</p>\r\n        </div>\r\n      </el-card>\r\n\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span>课程评价统计</span>\r\n        </div>\r\n        <div>\r\n          <div v-for=\"(stat, index) in courseStats\" :key=\"index\" class=\"stat-item\">\r\n            <h3>{{ stat.label }}</h3>\r\n            <p>高: {{ stat.high }}</p>\r\n            <p>中: {{ stat.medium }}</p>\r\n            <p>低: {{ stat.low }}</p>\r\n          </div>\r\n        </div>\r\n      </el-card>\r\n\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span>提交评价</span>\r\n        </div>\r\n        <div class=\"quick-reply-section\">\r\n          <el-form :model=\"newReview\" class=\"review-form\">\r\n            <el-form-item label=\"评分\">\r\n              <el-input v-model=\"newReview.rating\" type=\"number\" placeholder=\"请输入评分\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"评分人数\">\r\n              <el-input v-model=\"newReview.ratingCount\" type=\"number\" placeholder=\"请输入评分人数\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"难度\">\r\n              <el-select v-model=\"newReview.difficulty\" placeholder=\"请选择难度\">\r\n                <el-option label=\"简单\" value=\"简单\"></el-option>\r\n                <el-option label=\"普通\" value=\"普通\"></el-option>\r\n                <el-option label=\"较难\" value=\"较难\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"作业\">\r\n              <el-select v-model=\"newReview.homework\" placeholder=\"请选择作业量\">\r\n                <el-option label=\"少\" value=\"少\"></el-option>\r\n                <el-option label=\"适中\" value=\"适中\"></el-option>\r\n                <el-option label=\"多\" value=\"多\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"给分\">\r\n              <el-select v-model=\"newReview.grading\" placeholder=\"请选择给分\">\r\n                <el-option label=\"低\" value=\"低\"></el-option>\r\n                <el-option label=\"中\" value=\"中\"></el-option>\r\n                <el-option label=\"高\" value=\"高\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"收获\">\r\n              <el-select v-model=\"newReview.harvest\" placeholder=\"请选择收获\">\r\n                <el-option label=\"少\" value=\"少\"></el-option>\r\n                <el-option label=\"中\" value=\"中\"></el-option>\r\n                <el-option label=\"多\" value=\"多\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"评论\">\r\n              <el-input type=\"textarea\" v-model=\"newReview.comment\" placeholder=\"请输入评论\"></el-input>\r\n            </el-form-item>\r\n            <el-button type=\"primary\" @click=\"submitReview\">提交评价</el-button>\r\n          </el-form>\r\n        </div>\r\n      </el-card>\r\n\r\n      <el-card style=\"margin-bottom: 10px\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span>点评信息</span>\r\n        </div>\r\n        <div class=\"comments-section\">\r\n          <el-card v-for=\"review in reviews\" :key=\"review.id\" class=\"comment-card\">\r\n            <div class=\"comment-header\">\r\n              <span>{{ review.user_name }}</span>\r\n            </div>\r\n            <div class=\"comment-body\">\r\n              <p>评分: {{ review.rating }}</p>\r\n              <p>难度: {{ review.difficulty }}</p>\r\n              <p>作业: {{ review.homework }}</p>\r\n              <p>给分: {{ review.grading }}</p>\r\n              <p>收获: {{ review.harvest }}</p>\r\n              <p>{{ review.comment }}</p>\r\n            </div>\r\n          </el-card>\r\n          <el-pagination\r\n            style=\"margin-top: 20px;\"\r\n            @current-change=\"handleCurrentChange\"\r\n            :current-page=\"currentPage\"\r\n            :page-size=\"pageSize\"\r\n            layout=\"total, prev, pager, next\"\r\n            :total=\"totalReviews\">\r\n          </el-pagination>\r\n        </div>\r\n      </el-card>\r\n    </el-main>\r\n  </Layout>\r\n</template>\r\n\r\n<script>\r\nimport Layout from '@/components/Layout.vue'\r\nimport request from \"@/utils/request\";\r\n\r\nexport default {\r\n  components: {\r\n      Layout\r\n  },\r\n  data() {\r\n    return {\r\n      course: {\r\n        title: '马克思主义基本原理',\r\n        category: '计划',\r\n        type: '理论课',\r\n        method: '本科计划内课程',\r\n        unit: '马克思主义学院',\r\n        credit: 2.5\r\n      },\r\n      courseStats: [],\r\n      form: {\r\n        sort: '',\r\n        semester: '',\r\n        rating: ''\r\n      },\r\n      reviews: [],\r\n      newReview: {\r\n        course_id: this.$route.params.id,\r\n        rating: null,\r\n        ratingCount: null,\r\n        difficulty: '',\r\n        homework: '',\r\n        grading: '',\r\n        harvest: '',\r\n        comment: ''\r\n      },\r\n      currentPage: 1,\r\n      pageSize: 10,\r\n      totalReviews: 0\r\n    };\r\n  },\r\n  mounted() {\r\n    this.fetchCourseStats();\r\n    this.fetchCourseReviews();\r\n  },\r\n  methods: {\r\n    handleCollapse() {\r\n      console.log('Toggle sidebar');\r\n    },\r\n    handleFullScreen() {\r\n      console.log('Toggle full screen');\r\n    },\r\n    goBack() {\r\n      this.$router.go(-1);  // 返回前一个页面\r\n    },\r\n    handleCurrentChange(page) {\r\n      this.currentPage = page;\r\n      this.fetchCourseReviews(); // Fetch new page data\r\n    },\r\n    fetchCourseStats() {\r\n      request.get(`/evaluation/review/stats/${this.$route.params.id}`)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            this.courseStats = res.data;\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"获取课程评价统计失败:\", error);\r\n        });\r\n    },\r\n    fetchCourseReviews() {\r\n      request.get(`/evaluation/reviews/${this.$route.params.id}`)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            this.reviews = res.data;\r\n            this.totalReviews = res.data.length;\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"获取课程评价失败:\", error);\r\n        });\r\n    },\r\n    submitReview() {\r\n      if (!this.newReview.rating || !this.newReview.ratingCount || !this.newReview.difficulty || !this.newReview.homework || !this.newReview.grading || !this.newReview.harvest || !this.newReview.comment) {\r\n        this.$message.error('请填写完整信息');\r\n        return;\r\n      }\r\n      request.post('/evaluation/review/put', this.newReview)\r\n        .then(res => {\r\n          if (res.status === 200) {\r\n            this.$message.success('评价发布成功');\r\n            // 清空表单\r\n            this.newReview = {\r\n              course_id: this.$route.params.id,\r\n              rating: null,\r\n              ratingCount: null,\r\n              difficulty: '',\r\n              homework: '',\r\n              grading: '',\r\n              harvest: '',\r\n              comment: ''\r\n            };\r\n            this.fetchCourseReviews(); // 刷新评价列表\r\n            this.fetchCourseStats(); // 刷新统计数据\r\n          } else {\r\n            this.$message.error(res.data.msg);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error(\"发布评价失败:\", error);\r\n        });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.back_button {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n.forum-container {\r\n  width: 80%;\r\n  margin: auto;\r\n}\r\n.comment-card {\r\n  margin-top: 20px;\r\n}\r\n.comment-header {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.user-avatar {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  margin-right: 10px;\r\n}\r\n.comment-body {\r\n  margin-top: 10px;\r\n}\r\n.comment-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  margin-top: 10px;\r\n}\r\n.quick-reply-section {\r\n  margin-top: 20px;\r\n}\r\n.stat-item {\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"],"mappings":"AAmHA,OAAAA,MAAA;AACA,OAAAC,OAAA;AAEA;EACAC,UAAA;IACAF;EACA;EACAG,KAAA;IACA;MACAC,MAAA;QACAC,KAAA;QACAC,QAAA;QACAC,IAAA;QACAC,MAAA;QACAC,IAAA;QACAC,MAAA;MACA;MACAC,WAAA;MACAC,IAAA;QACAC,IAAA;QACAC,QAAA;QACAC,MAAA;MACA;MACAC,OAAA;MACAC,SAAA;QACAC,SAAA,OAAAC,MAAA,CAAAC,MAAA,CAAAC,EAAA;QACAN,MAAA;QACAO,WAAA;QACAC,UAAA;QACAC,QAAA;QACAC,OAAA;QACAC,OAAA;QACAC,OAAA;MACA;MACAC,WAAA;MACAC,QAAA;MACAC,YAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,gBAAA;IACA,KAAAC,kBAAA;EACA;EACAC,OAAA;IACAC,eAAA;MACAC,OAAA,CAAAC,GAAA;IACA;IACAC,iBAAA;MACAF,OAAA,CAAAC,GAAA;IACA;IACAE,OAAA;MACA,KAAAC,OAAA,CAAAC,EAAA;IACA;IACAC,oBAAAC,IAAA;MACA,KAAAf,WAAA,GAAAe,IAAA;MACA,KAAAV,kBAAA;IACA;IACAD,iBAAA;MACA/B,OAAA,CAAA2C,GAAA,kCAAAzB,MAAA,CAAAC,MAAA,CAAAC,EAAA,IACAwB,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,MAAA;UACA,KAAApC,WAAA,GAAAmC,GAAA,CAAA3C,IAAA;QACA;UACA,KAAA6C,QAAA,CAAAC,KAAA,CAAAH,GAAA,CAAAI,GAAA;QACA;MACA,GACAC,KAAA,CAAAF,KAAA;QACAb,OAAA,CAAAa,KAAA,gBAAAA,KAAA;MACA;IACA;IACAhB,mBAAA;MACAhC,OAAA,CAAA2C,GAAA,6BAAAzB,MAAA,CAAAC,MAAA,CAAAC,EAAA,IACAwB,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,MAAA;UACA,KAAA/B,OAAA,GAAA8B,GAAA,CAAA3C,IAAA;UACA,KAAA2B,YAAA,GAAAgB,GAAA,CAAA3C,IAAA,CAAAiD,MAAA;QACA;UACA,KAAAJ,QAAA,CAAAC,KAAA,CAAAH,GAAA,CAAAI,GAAA;QACA;MACA,GACAC,KAAA,CAAAF,KAAA;QACAb,OAAA,CAAAa,KAAA,cAAAA,KAAA;MACA;IACA;IACAI,aAAA;MACA,UAAApC,SAAA,CAAAF,MAAA,UAAAE,SAAA,CAAAK,WAAA,UAAAL,SAAA,CAAAM,UAAA,UAAAN,SAAA,CAAAO,QAAA,UAAAP,SAAA,CAAAQ,OAAA,UAAAR,SAAA,CAAAS,OAAA,UAAAT,SAAA,CAAAU,OAAA;QACA,KAAAqB,QAAA,CAAAC,KAAA;QACA;MACA;MACAhD,OAAA,CAAAqD,IAAA,gCAAArC,SAAA,EACA4B,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,MAAA;UACA,KAAAC,QAAA,CAAAO,OAAA;UACA;UACA,KAAAtC,SAAA;YACAC,SAAA,OAAAC,MAAA,CAAAC,MAAA,CAAAC,EAAA;YACAN,MAAA;YACAO,WAAA;YACAC,UAAA;YACAC,QAAA;YACAC,OAAA;YACAC,OAAA;YACAC,OAAA;UACA;UACA,KAAAM,kBAAA;UACA,KAAAD,gBAAA;QACA;UACA,KAAAgB,QAAA,CAAAC,KAAA,CAAAH,GAAA,CAAA3C,IAAA,CAAA+C,GAAA;QACA;MACA,GACAC,KAAA,CAAAF,KAAA;QACAb,OAAA,CAAAa,KAAA,YAAAA,KAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}